@import '../prelude';
@import './audio-player.less';

.akso-magazines {
    .magazines-access-banner {
        background: var(--bg2);
        border-radius: var(--radius);
        box-shadow: @inset-both;
        padding: 1em;

        h3:first-child {
            margin-top: 0;
        }

        .inner-actions {
            text-align: right;
        }
    }

    .magazines-cover-gallery {
        padding: 0;
        list-style-type: none;

        display: flex;
        justify-content: center;
        align-items: flex-end;
        flex-wrap: wrap;

        .magazine-item {
            display: inline-block;
            margin: 0.5em;
            flex: 1;
            min-width: 13em;
            max-width: 16em;

            .item-inner-card {
                position: relative;
                background: var(--bg);
                border-radius: var(--radius);
                box-shadow: @shade-both;
                overflow: hidden;
                padding-bottom: 0.5em;
                border-bottom: 0.5em solid var(--accent);

                .item-title {
                    display: block;

                    .inner-title {
                        margin: 0;
                        text-align: center;
                        padding: 0.5em;
                        padding-bottom: 0.2em;
                    }
                }
                .item-subtitle {
                    margin: 0;
                    margin-bottom: 0.5em;
                    text-align: center;
                }

                .item-edition-title {
                    text-align: center;
                    font-size: 1.1em;
                    margin-top: 0.6em;
                    margin-bottom: 0;
                }
                .item-edition-date {
                    text-align: center;
                    font-size: 0.875em;
                    margin-bottom: 0.5em;
                }

                .item-cover-link {
                    display: block;
                    position: relative;
                    text-align: center;

                    .item-cover-stack-item {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        width: 100%;
                        transform: translate(-50%, -50%) rotate(4deg);
                        pointer-events: none;
                    }

                    .magazine-cover-container {
                        --magazine-cover-width: 10em;
                    }
                }

                .item-download-container {
                    margin: 0;

                    .item-download {
                        display: block;
                        text-align: center;
                        margin: 0;
                        padding-top: 0.5em;
                        padding-bottom: 0.5em;
                    }
                }

                .toc-preview-button-container {
                    text-align: center;
                    padding-bottom: 0.2em;

                    .toc-preview-button {
                        font-size: smaller;
                    }
                }
            }
        }
    }

    .magazines-back-container {
        padding-top: 1em;
    }

    &.is-magazine-page {
        .magazine-edition-years {
            padding: 1em;
            box-shadow: @shade-both;
            border-radius: var(--radius);
            background: var(--bg);
            list-style-type: none;

            .edition-year-item {
                margin: 0;
                display: inline-block;
                padding: 0 0.5em;
            }
        }

        .edition-year-header {
            white-space: nowrap;

            &.pulse {
                .section-marker-inner {
                    position: relative;
                    display: inline-block;
                    animation: magazine-edition-year-header-pulse-mi 1s ease-out both;

                    @keyframes magazine-edition-year-header-pulse-mi {
                        15% {
                            transform: scale(0.98);
                        }
                        40% {
                            transform: scale(1.2);
                        }
                        65% {
                            transform: scale(0.95);
                        }
                    }
                }

                position: relative;

                &::after {
                    content: '';
                    position: absolute;
                    display: block;
                    width: 0.5em;
                    height: var(--border-width);
                    top: 50%;
                    left: 0;
                    transform-origin: 100% 0;
                    background: var(--bg);
                    animation: magazine-edition-year-header-pulse-a 0.5s 0.5s ease-out both;
                    @keyframes magazine-edition-year-header-pulse-a {
                        0% {
                            transform: translateY(-50%) scaleX(0);
                            opacity: 1;
                        }
                        100% {
                            transform: translateY(-50%) scaleX(1);
                            opacity: 0;
                        }
                    }
                }

                .section-marker-fill {
                    position: relative;

                    &::before {
                        content: '';
                        position: absolute;
                        display: block;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: var(--bg);
                        transform-origin: 0 0;
                        animation: magazine-edition-year-header-pulse-mf 1s 0.5s ease-out both;

                        @keyframes magazine-edition-year-header-pulse-mf {
                            0% {
                                transform: scaleX(0);
                                opacity: 1;
                            }
                            100% {
                                transform: scaleX(1);
                                opacity: 0;
                            }
                        }
                    }
                }
            }
        }
    }

    .magazines-inner-back-container {
        padding-left: 0;

        .back-icon {
            width: 0.5em;
            transform: translateX(-0.5em);
        }
    }

    &.is-edition-page {
        .edition-page-content-split {
            display: flex;
            align-items: flex-start;
            background: var(--bg);
            border-radius: var(--radius);
            box-shadow: @shade-both;

            .edition-cover {
                .inner-cover {
                    display: block;
                    width: 30vw;
                    max-width: 300px;
                    border-radius: var(--radius);
                }
            }

            @media (max-width: 600px) {
                flex-direction: column;
                align-items: center;

                .edition-cover .inner-cover {
                    width: 50vw;
                }
            }
            @media (max-width: 420px) {
                .edition-cover .inner-cover {
                    width: 70vw;
                }
            }
        }

        .edition-info {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 100%;
            align-self: stretch;

            .edition-details-container {
                padding: 1em;
                flex: 1;
                flex-shrink: 0;

                .edition-title {
                    font-size: 1.7em;
                }

                .edition-date {
                    font-size: 0.9em;
                }
            }
            .edition-downloads {
                display: flex;
                border-top: 1px solid var(--accent);
                padding: 1em;

                .download-button {
                    display: flex;
                    width: 100%;
                    margin: 0;
                    align-items: center;
                    padding: 0 0.1em;

                    .download-icon {
                        vertical-align: middle;
                        padding: 0.5em;
                    }
                    .download-label {
                        flex: 1;
                        border-left: 1px solid var(--light-separator);
                        padding: 0.5em;
                        text-align: left;
                    }

                    &.requires-login {
                        .dl-login-arrow {
                            display: inline-block;
                            position: relative;
                            width: 1em;
                            height: 1em;
                            margin-right: 0.5em;
                            transition: transform 0.3s cubic-bezier(.2, .3, 0, 1);

                            &::before, &::after {
                                content: '';
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                width: 0.6em;
                                height: 0.2em;
                                background: currentColor;
                                transform-origin: 0.1em 50%;
                                transform: translate(-0.1em, -0.1em) rotate(135deg);
                            }
                            &::after {
                                transform: translate(-0.1em, -0.1em) rotate(-135deg);
                            }
                        }

                        &:hover .dl-login-arrow {
                            transform: translateX(0.2em);
                        }
                    }
                }

                .download-button + .download-button {
                    margin-left: 1em;
                }

                .downloads-empty-notice {
                    flex: 1;
                    text-align: center;
                    font-size: 0.875em;
                }

                @media (max-width: 700px) {
                    display: block;

                    .download-button + .download-button {
                        margin-top: 0.5em;
                        margin-left: 0;
                    }
                }
            }
        }

        .edition-contents {
            border-radius: var(--radius);
            background: var(--bg2);
            margin-top: 1em;
            box-shadow: @inset-both;

            .edition-contents-title {
                padding: 0.5em 1em;
                padding-top: 0.7em;

                h2 {
                    margin: 0;
                    text-align: center;
                }
            }

            #edition-content-list-collapse {
                display: none;
            }

            .edition-content-list {
                margin: 0;
                list-style-type: none;
                padding: 0;
                text-align: left;

                .content-list-item {
                    padding: 0.5em 1em;
                    border-top: 1px solid rgba(0, 0, 0, 0.1);
                    line-height: 1.2;
                    animation: magazine-edition-content-list-item-expand 0.5s cubic-bezier(.2, .3, 0, 1);
                    transition: background 0.5s cubic-bezier(.2, .3, 0, 1);
                    box-sizing: border-box;
                    --li-approx-height: 2.25em;

                    &.has-author {
                        --li-approx-height: 3.25em;
                    }
                    &.has-recitation {
                        --li-approx-height: 5.1em;
                    }
                    &.has-author.has-recitation {
                        --li-approx-height: 6.1em;
                    }

                    @keyframes magazine-edition-content-list-item-expand {
                        0% {
                            height: 4px;
                            padding-top: 0;
                            padding-bottom: 0;
                        }
                        100% {
                            height: var(--li-approx-height);
                        }
                    }

                    .entry-title-line {
                        display: flex;
                        align-items: baseline;
                        flex-wrap: wrap;

                        .entry-dots {
                            content: '';
                            display: inline-block;
                            width: 100%;
                            flex: 1;
                            margin: 0 0.2em;
                            border-bottom: 1px dotted currentColor;
                            opacity: 0.6;
                        }
                    }

                    .entry-author-line {
                        opacity: 0.8;
                        font-size: 0.875em;
                    }
                }
            }

            #edition-content-list-collapse:checked + .edition-content-list {
                .content-list-item:not(.is-highlighted) {
                    height: 4px;
                    padding-top: 0;
                    padding-bottom: 0;
                    background: var(--light-separator);
                    animation: magazine-edition-content-list-item-collapse 0.3s cubic-bezier(.2, .3, 0, 1);

                    @keyframes magazine-edition-content-list-item-collapse {
                        0% {
                            height: var(--li-approx-height);
                            padding-top: 0.5em;
                            padding-bottom: 0.5em;
                        }
                    }

                    & > * {
                        display: none;
                    }
                }
            }

            .content-list-collapse-button {
                display: block;
                position: relative;
                width: 100%;
                box-sizing: border-box;
                padding: 0.5em 1em;
                text-align: center;
                transition: margin-top 0.3s cubic-bezier(.2, .3, 0, 1);
                color: var(--accent);
                border-radius: var(--radius);

                &::before {
                    content: '';
                    position: absolute;
                    background: linear-gradient(to top, var(--bg2), var(--bg2-0));
                    pointer-events: none;
                    height: 200%;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    border-radius: 0 0 var(--radius) var(--radius);
                    transition: opacity 0.3s cubic-bezier(.2, .3, 0, 1);
                    opacity: 0;
                }

                .inner-collapse-icon {
                    position: relative;
                    display: inline-block;
                    width: 1em;
                    height: 1em;
                    transition: transform 0.3s cubic-bezier(.2, .3, 0, 1);

                    &::before, &::after {
                        content: '';
                        position: absolute;
                        background: currentColor;
                        width: 0.6em;
                        height: 0.2em;
                        top: 50%;
                        left: 50%;
                        transform-origin: 0.1em 0.1em;
                        transition: transform 0.3s cubic-bezier(.2, .3, 0, 1);
                    }
                    &::before {
                        transform: translate(-0.1em, -0.2em) rotate(45deg);
                    }
                    &::after {
                        transform: translate(-0.1em, -0.2em) rotate(-225deg);
                    }
                }

                .inner-expand-label,
                .inner-collapse-label {
                    display: inline-block;
                    z-index: 1;
                    position: relative;
                }

                .inner-expand-label {
                    display: none;
                }

                .inner-collapse-icon {
                    transform: translateY(0.1em);
                }

                &:hover .inner-collapse-icon {
                    transform: translateY(0em);
                }

                &:focus {
                    outline: none;
                    box-shadow: 0 0 0 var(--border-width) var(--accent-50);
                    transition: margin-top 0.3s cubic-bezier(.2, .3, 0, 1);
                }
            }

            #edition-content-list-collapse:checked ~ .content-list-collapse-button {
                &::before {
                    opacity: 1;
                }

                .inner-collapse-icon {
                    transform: translateY(0em);

                    &::before {
                        transform: translate(-0.1em, 0.2em) rotate(-45deg);
                    }
                    &::after {
                        transform: translate(-0.1em, 0.2em) rotate(-135deg);
                    }
                }

                .inner-expand-label {
                    display: inline-block;
                }
                .inner-collapse-label {
                    display: none;
                }

                &:hover .inner-collapse-icon {
                    transform: translateY(0.1em);
                }
            }
        }
    }

    .entry-recitation {
        font-size: 0.875em;
        margin-top: 0.5em;
        border: 1px solid var(--light-separator);
        border-radius: var(--radius);
        padding: 0.5em;
        display: flex;
        align-items: center;

        .recitation-audio {
            max-width: 300px;

            audio {
                margin: 0;
                display: block;
            }
        }

        .recitation-label {
            flex: 1;
            margin-left: 0.5em;
        }

        &.is-interactive-audio-player {
            padding: 0;
            display: block;
            border: none;
            border-radius: 0;
            font-size: inherit;
        }
    }

    &.is-toc-entry-page {
        .toc-entry-info {
            margin-bottom: 0.5em;
            .entry-title {
                margin-bottom: 0;

                strong {
                    font-weight: bolder;
                }
            }
            .entry-author {
                margin-top: 0.5em;
                margin-bottom: 0;
                opacity: 0.8;
            }
        }

        .toc-sticky-recitation {
            background: var(--bg);

            &.is-sticky {
                position: sticky;
                top: 1em;
            }
        }

        .toc-entry-recitation-meta {
            .recitation-download {
                margin: 0.3em 0;
                text-align: right;
                font-size: 0.875em;

                .download-link {
                    display: inline-block;
                }

                :last-child {
                    margin-right: 0;
                }
            }
        }

        .toc-entry-text {
            background: var(--bg);
            border-radius: var(--radius);
            padding: 1em;
            box-shadow: @shade-both;

            p:first-child {
                margin-top: 0;
            }
            p:last-child {
                margin-bottom: 0;
            }

            &.requires-perms {
                background: var(--error-bg);
                color: var(--error-fg);
                --accent: var(--error-fg);
            }
        }
    }
}
